<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
        <script  src="https://code.jquery.com/jquery-3.1.1.min.js"   integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8="   crossorigin="anonymous"></script>
        <script>
            var requestURL = window.location.protocol + '//' + window.location.hostname + "/problemList";
            var data = "";
            $.ajax({
                url: requestURL,
                type: "GET",
                contentType: "application/json;charset=utf-8",
                success: function(returnData){
                    //console.log(returnData);
                    createTable(returnData);
                },
                error: function(xhr, ajaxOptions, thrownError){
                    console.log(xhr.status);
                    console.log(thrownError);
                    data = "";
                }
            });
            function createTable(data){
                console.log(data);
                data = JSON.parse(data);
                var div = document.getElementById("mainDiv");
                var table = document.createElement("table");
                table.setAttribute("class", "table table-hover");
                var headers = ["problem_id", "problem_name", "problem_deadline", "problem_author"];
                var headers_translate = ["題目 ID", "題目名稱", "題目期限", "題目作者"];
                var dataCount = parseInt(data["DataCount"]);
                console.log(data["DataCount"]);
                for(var i = 0; i < dataCount; i++){
                    var row = table.insertRow(i);
                    for(var j = 0; j < headers.length; j++){
                        let cell = row.insertCell(j);
                        let value = data["problemData"][i][headers[j]];
                        if(headers[j] == "problem_name"){
                            let a = document.createElement("a");
                            a.setAttribute("href", window.location.protocol + '//' + window.location.hostname + "/problem/" + data["problemData"][i]["problem_id"]);
                            a.innerText = value;
                            cell.appendChild(a);
                            continue;
                        }
                        if(headers[j] == "problem_deadline"){
                            if(parseInt(value) == 0){
                                value = "無限期";
                            }else{
                                var date = new Date(value);
                                value = date.toString();
                            }
                        }
                        if(headers[j] == "problem_author"){
                            let a = document.createElement("a");
                            a.setAttribute("href", window.location.protocol + '//' + window.location.hostname + "/profile/" + value);
                            a.innerText = value;
                            cell.appendChild(a);
                            continue;
                        }
                        cell.innerText = value;
                    }
                }
                var header = table.createTHead();
                header.setAttribute("class", "thead-dark")
                var headerRow = header.insertRow(0);
                for(var j = 0; j < headers_translate.length; j++){
                    headerRow.insertCell(j).outerHTML = "<th>" + headers_translate[j] + "</th>";
                }
                div.append(table);
            }
        </script>
	</head>
    <body>
		<nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="./"> NuOJ </a>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                <div class="navbar-nav">
                    <a class="nav-item nav-link" href="./problem"> 題目 </a>
                    <a class="nav-item nav-link" href="./submit"> 提交 </a>
                    <a class="nav-item nav-link" href="./submissions"> 提交列表 </a>
                </div>
                <div class="navbar-nav ml-auto">
                    <a class="nav-item nav-link" href="./login"> 登入 </a>
                    <a class="nav-item nav-link" href="./register"> 註冊 </a> 
                </div>
            </div>
        </nav>
        <div class="container" id="mainDiv">
            <h1 class = "display-3"> NuOJ ProblemList </h1>
        </div>
    </body>
</html>